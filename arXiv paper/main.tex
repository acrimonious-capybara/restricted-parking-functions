% arXiv-friendly version of the paper
\documentclass[12 pt]{amsart}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}

\usepackage[largesc]{newpxtext}
\usepackage[varbb]{newpxmath}

% wider margins just for now, so that todonotes are easily visible
\usepackage[margin = 1.5 in]{geometry}
\usepackage{microtype}

% theorem setup
\usepackage{amsthm, thmtools, thm-restate}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{conjecture}[theorem]{Conjecture}
\theoremstyle{definition} % definition style
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\theoremstyle{remark} % remark style
\newtheorem{remark}[theorem]{Remark}

\usepackage{hyperref, cleveref}
\hypersetup{ % make links pretty and not boxed
colorlinks,
linkcolor = blue,
urlcolor = blue,
citecolor = blue}

% add your own todostyle!
\usepackage{todonotes}
\todostyle{jayden}{color = pink}
\todostyle{jasper}{color = lime}
\todostyle{alan}{color = purple}

\title{Preference-restricted parking functions}

\author[Kappler]{Alan Kappler}
\address[A. Kappler]{Harvey Mudd College, United States}
\email{akappler@g.hmc.edu}

\author[Thadani]{Jayden Thadani}
\address[J. Thadani]{Harvey Mudd College, United States}
\email{jthadani@hmc.edu}

% \author[Bown]{Jasper Bown}
% \address[J. Bown]{Harvey Mudd College, United States}
% \email{abown@g.hmc.edu}

\begin{document}
	

\begin{abstract}
	We demonstrate a new paradigm for solving parking problems --- preference-restricted parking functions. By considering parking functions of length $n$ where all cars prefer spots in some convenient $S \subset [n]$, we convert questions about complicated parking procedures into more easily understood questions about ordinary parking functions. In particular, we demonstrate choices of $S$ that yield new combinatorial insights to the results in \cite{cameron-johannsen-prellberg-schweitzer-2008} and a proof of Abel's binomial theorem, an elementary proof of a difficult result of \cite{blake-konheim-1977} and a new characterization of prime parking functions respectively.
\end{abstract}

\maketitle

\pagebreak

\tableofcontents

\pagebreak

% just set up to make sure the todo list gets printed fine at the start of the doc
\makeatletter
\providecommand\@dotsep{5}
\makeatother
\listoftodos\relax

\pagebreak

\section{Introduction}

The classical parking function problem is to describe the parking preferences cars can have that allow every car to park under a certain parking procedure. Each of $n$ cars goes down a one-way street with $n$ parking spots, attempts to park in its preferred spot, and then each subsequent spot until it parks.

The \emph{parking functions} $\pi : [n] \to [n]$ that take cars to a list of preferences that allows everyone to park are well understood. However, many of the variants of the parking function question considered in the literature do not fully leverage our knowledge of parking functions ---
\begin{enumerate}
	\item What if there are fewer cars than spots? How can we minimize the number of cars unable to park? (A special case of the variants considered in \cite{cameron-johannsen-prellberg-schweitzer-2008}.)
	\item What if each parking spot can accommodate more than one car? (Perhaps, as in \cite{blake-konheim-1977}, our parking spots are hash buckets, and our cars are data.)
	\item Prime parking functions.
\end{enumerate}
We will show that all of these can be understood as \emph{$S$-restricted parking functions} --- parking functions $\pi : [n] \to S \subset [n]$. 

These reinterpretations yield more complete theories of the variants, new combinatorial insights \todo[jayden]{remove if we don't have room for any of the equivalence class results on $[s]$-restrictions}, simpler proofs, and connections to deep results in combinatorics. In some sense, $S$-restricted parking functions is a paradigm for solving parking questions that strikes the balance between the power of $\mathbf{u}$-parking functions and the obvious combinatorial intuition of the original parking function question.

\section{Initial segment restrictions}

\begin{definition}
    An $S$-restricted parking function on $n$ cars, given a set of possible preferences $S,$ is a parking function on $n$ cars where all preferences lie in $S.$ We denote the number of parking functions of this type as $\# \mathrm{PF}_{n\mid S}.$
\end{definition}

Note that since every parking function has at least one preference equal to $1,$ $\# \mathrm{PF}_{n\mid S}$ is only nonzero when $1\in S.$ One natural type of restriction to look at, then, is one where only the first few spots can be preferred. Specifically, we look at restrictions to $[s],$ where $1\le s\le n.$

This type of set is closely related to a another variant on classical parking functions, when the number of cars differs from the number of spots to park in. \cite{cameron-johannsen-prellberg-schweitzer-2008} studies this idea in some depth. One particularly interesting case occurs when there are more cars than parking spots; not all cars will be able to park, but we can try to minimize the defect of the system (that is, the number of cars which are unable to park).

\begin{theorem}
    Given $1\le s\le n,$ the number of ways for $n$ cars to park in $s$ spots, with the minimum possible defect of $n-s,$ is equal to $\# \mathrm{PF}_{n \mid [s]}.$
\end{theorem}

\begin{proof}
    We have in both situations a set of preference lists which are of length $n$ and taking values in $[s]$; we'd like to prove that they coincide. To do so, add to the end of our street of $s$ spots an ``overflow lot" of length $n-s.$ Our case with minimum defect will occur only when the overflow lot is exactly full: that is, if all cars can park in one of the $s+(n-s)=n$ spots we've constructed.

    But this is exactly analogous to our parking procedure! We have $n$ cars parking in the first $s$ of $n$ spots, and a parking function only occurs when all cars can park. This gives the bijection we want.
\end{proof}

A natural question to ask: how many $[s]$-restricted parking functions are there? This is answered by \cite{cameron-johannsen-prellberg-schweitzer-2008} through a combinatorial proof, reproduced here in the language of $[s]$-restricted parking functions:

\begin{restatable}{theorem}{resPFcount1}
    \label{thm:resPFcount1}
    Let $1\le s\le n.$ Then the number of $[s]$-restricted parking functions on $n$ cars is
    \[s^{n} - \sum_{i = 0}^{s - 1} \binom{n}{i} (i + 1)^{i - 1} (s - i - 1)^{n - i}.\]
\end{restatable}

\begin{proof}
    There are $s^{c}$ possible preference lists in $[s]^{c}$, when not considering the constraint of being a parking function. If $\pi \in [s]^{c}$ is not a parking function, then there must be an unoccupied spot somewhere among the $c$ spots; all such unoccupied spots lie in $[s],$ since least $c - s$ cars come to the last $c - s$ spots by the minimum-defect argument above, filling the whole 

	Let $i$ be the number of spots before the first unoccupied spot. Then there must be $i$ cars that form a parking function on those first $i$ spots. Choose those $i$ cars in one of $\binom{c}{i}$ ways, and one of the $(i + 1)^{i - 1}$ parking functions of length $i$. None of the remaining $c - i$ cars can prefer any of the first $i + 1$ spots since they would end up parking in the unoccupied spot $i + 1$. However, they each can prefer any of the remaining $s - i - 1$ spots in one of $(s - i - 1)^{c - i}$ ways. This makes for $\binom{c}{i} (i + 1)^{i - 1}(s - i - 1)^{c - i}$ preference lists in $[s]^{c}$ so that the first unoccupied spot is $i + 1$. Subtracting the sum over all possible $i$ from the number of total preference lists gives us the first enumeration ---
	\[
		\# \mathrm{PF}_{c \mid [s]} = s^{c} - \sum_{i = 0}^{s - 1} \binom{c}{i} (i + 1)^{i - 1} (s - i - 1)^{c - i}.
	\]
\end{proof}



\begin{restatable}{theorem}{resPFcount2}
    \label{thm:resPFcount2}
    The number of $[s]$-restricted parking functions on $n$ cars may be expressed as
    \[\sum_{i = s}^{n} \binom{n}{i} (i + 1)^{i - 1} (s - i - 1)^{n - i}.\]
\end{restatable}

\begin{theorem}
    \label{thm:resPPFcount1}
    For $1 \le s < n,$, the number of $[s]$-restricted parking functions on $n$ cars which are also prime is 
    \[s^{n} - (s - 1)^{n} - \sum_{i = 1}^{s} \binom{n}{i} (i - 1)^{i - 1} (s - i)^{n - i}.\]
\end{theorem}

\begin{theorem}
    \label{thm:resPPFcount2}
    For $1 \le s < n,$ the number of $[s]$-restricted parking functions on $n$ cars which are also prime may be expressed as
    \[\sum_{i = s + 1}^{n} \binom{n}{i} (i - 1)^{i - 1} (s - i)^{n - i}\]
\end{theorem}

\subsection{Abel's binomial theorem}

In enumerating $[s]$-restricted parking functions and their prime variants, we demonstrated two different counts for each --- one by excluding all of the restricted preference lists that aren't the desired type of parking function, another by taking all parking functions and allowing those with forbidden preferences to cancel. The expressions we get from these two approaches are very similar; this isn't a coincidence!

Abel's binomial theorem is a generalization of the standard binomial theorem, with deep roots in the theory of reluctant functions and forests. The identity has many equivalent statements, but perhaps most common is the following version:

\begin{restatable}[Abel's binomial theorem]{theorem}{abelsbin}
	For all $n\in\mathbb{N}$ and $x,y\in\mathbb{R},$
    \[
		(x + y + n)^{n} = \sum_{i = 0}^{n} \binom{n}{i} x (x + i)^{i - 1} (y + n - i)^{n - i}.
	\]
\end{restatable}

Setting \cref{thm:resPFcount1} and \cref{thm:resPFcount2} equal gives a special case of this identity:
\begin{align*}
    s^{n} &= \sum_{i = 0}^{s - 1} \binom{n}{i} (i + 1)^{i - 1} (s - i - 1)^{n - i} + \sum_{i = s}^{n} \binom{n}{i} (i + 1)^{i - 1} (s - i - 1)^{n - i}\\
    &=\sum_{i = 0}^{n} \binom{n}{i} (i + 1)^{i - 1} (s - i - 1)^{n - i},
\end{align*}
which is Abel's theorem for $x=1,$ $y=s-n-1.$ Similarly, setting \cref{thm:resPPFcount1} and \cref{thm:resPPFcount2} equal gives 
\begin{align*}
    - (s - 1)^{n} &= -s^n + \sum_{i = 1}^{s} \binom{n}{i} (i - 1)^{i - 1} (s - i)^{n - i} + \sum_{i = s + 1}^{n} \binom{n}{i} (i - 1)^{i - 1} (s - i)^{n - i}\\
    &=\sum_{i=0}^n \binom{n}{i} (i - 1)^{i - 1} (s - i)^{n - i},
\end{align*}
which is Abel's theorem for $x=-1,$ $y=s-n+1.$ It's rather surprising that we'd find this-- there's no clear reason why these two sums should merge, especially considering that one half of the sum is alternating and the other isn't!

These are merely special cases, but we can actually recover the complete form of the identity from this! To do so, we'll need a result from \cite{yan-survey-2015}, giving a generating function for the number of preferences for the first spot in a parking fucntion:

\begin{lemma}
    The sum over all length-$n$ parking functions $\pi$ of $x^{|\pi^{-1}(\{1\})|}$ is $x(x+n)^{n-1}$ for any $n\in\mathbb{N}.$
\end{lemma}

Note that this reduces to the usual $(n+1)^{n-1}$ when setting $x=1$; Yan uses a clever construction involving a bijection with labeled trees. This gives us a rather more general form for our identity:

\begin{theorem}
    \label{thm:res-1s-enumerator}
    The sum over $[s]$-restricted length-$n$ parking functions $\pi$ of $x^{|\pi^{-1}(\{1\})|}$ may be expressed as
    \[(s-1+x)^{n} - \sum_{i = 0}^{s - 1} \binom{n}{i} x(x + i)^{i - 1} (s - i - 1)^{n - i},\]
    or as
    \[\sum_{i = s}^{n} \binom{n}{i} x(x + i)^{i - 1} (s - i - 1)^{n - i}.\]
\end{theorem}

\begin{proof}
    We omit most of the details here, as they follow along lines very similar to \cref{thm:resPFcount1} and \cref{thm:resPFcount2}.
    
    For the first claim, $(s-1+x)^n$ is a generating function for all preference functions restricted to $[s],$ as the number of preference functions with $k$ 1s is $\binom{n}{k}1^k(s-1)^{n-k}.$ In each term of the sum we're subtracting off, $x(x+1)^{i-1}$ counts parking functions of length $i$; the $(s-i-1)^{n-i}$ represents preferences after the first gap in the parking lot, and therefore it has no 1s to account for.

    The second claim proceeds similarly; $x(x+1)^{i-1}$ again counts parking functions of length $i$. Since $(s-i-1)^{n-i}$ counts red cars, which always prefer forbidden spots greater than $s\ge1,$ we again needn't account for preferences of 1 here. From this point on the proofs are identical.
\end{proof}

This means that for all $n\in\mathbb{N},$ $s\in [n],$ $x\in\mathbb{R},$
\[(s-1+x)^{n} = \sum_{i = 0}^{n} \binom{n}{i} x(x + i)^{i - 1} (s - i - 1)^{n - i}.\]
In particular, viewing both sides of the expression as a polynomial in $s$: for any $n\in\mathbb{N}$ and $x\in\mathbb{R},$ we have two monic polynomials $f(s)$ and $g(s)$ of degree $n$ which agree on $n$ distinct values; these must then be equal since $f(s)-g(s)$ is of degree at most $n-1$ and has at least $n$ roots.

Thus the above identity is true for all $x,s\in\mathbb{R}$ and $n\in\mathbb{N}.$ Substituting $s=n+1+y$ recovers Abel's full theorem.

\section{Prime parking functions}

Prime parking functions also have a characterization in terms of $S$-restricted parking functions --- prime parking functions are in bijection with parking functions where no car prefers the second spot. Essentially, this bijection follows by ``moving cars' preferences'' to the left, over the second spot.

\begin{restatable}{theorem}{primeIsRes}
	There is a bijection between prime parking functions and $[n] \setminus \{ 2 \}$-restricted parking functions (of length $n$). That is,
	\[
		\# \mathrm{PPF}_{n} = \# \mathrm{PF}_{n \mid [n] \setminus \{ 2 \}} 
	\]
\end{restatable}

In fact, this generalises to a way to enumerate $S$-restricted prime parking functions as $T$-restricted parking functions for some related subset $T$. We just prove this more general statement.

\begin{restatable}{theorem}{resPrimeIsRes}
	There is a bijection between $S$-restricted prime parking functions and $T$-restricted parking functions (of length $n$) where
	\[
		T = \{ 1 \} \cup \{ i + 1 \mid i \in S, 1 < i < n \}.
	\]
	That is,
	\[
		\# \mathrm{PPF}_{n \mid S} = \# \mathrm{PF}_{n \mid T}.
	\]
\end{restatable}

\begin{proof}
	Consider the natural bijection $f : S \setminus \{ c \} \to T$ that moves every $i \in T$ one place over. That is, $f(1) = 1$ and $f(x) = x + 1$ otherwise. We claim this pushes forward to a bijection from $S$-restricted prime parking functions to $T$-restricted parking functions by $f^{*} : \pi \mapsto f \circ \pi$.

	It follows that $f^{*}$ since $f$ is. Thus, we only need to show that its image is $\mathrm{PF}_{n \mid T}$. If $\pi$ is an $S$-restricted prime parking function $f \circ \pi$ is by definition a function $[n] \to T$. Since $\pi$ is prime, more than $i$ cars prefer a spot in the first $i$ for each $i$. For $f \circ \pi$, since $f(1) = 1$, this means that at least $2$ cars prefer one of the first $2$ spots (both prefer the first spot). For $i > 2$, all the cars $j$ with $\pi(j) \le i - 1$ now prefer spots in the first $i$. Since there are $k > i - 1$ and thus, $k \ge i$ of these, there are at least $i$ cars preferring spots in the first $i$. That is, $f^{*} \pi$ is a parking function.

	These equalities work in reverse too! For any $T$-restricted parking function $\psi$, $f^{-1} \circ \psi$ is a function $[n] \to S$. Again $\psi$ must have $2$ cars prefer the first spot. For every other $i$th spot ($i > 1$), there are at least $i + 1$ cars $j$ such that $\psi(j) \le i + 1$ and thus, more than $i$ cars such that $(f^{-1} \circ \psi)(j) \le i$. Thus, $f^{*}$ is the desired bijection.
\end{proof}

\section{Modular restrictions}

In \cite{blake-konheim-1977}, Blake and Konheim consider a variant of the parking problem applicable to hash buckets. \todo[jayden]{read up and add more context on this (?)} Specifically, they consider the problem of parking cars in a lot with many rows of parking spot where cars have preferences for the rows. Using machinery from complex analysis and generating functions, they obtain an enumeration of the ``parking functions'' under this modified parking procedure. \todo[jayden]{reference \cite{blake-konheim-1977} corollary 2.1}

Instead of considering $s$ rows with $g$ parking spots each, \todo[jayden]{except the last row (?)} we imagine placing these rows one after each other to form a long one-way street and only permit cars to prefer the first spot in each row. This equivalent problem is a restricted parking function! Now we can use the circular symmetry of parking functions to enumerate these restricted parking functions, in a manner similar to Pollak's enumeration of parking functions \todo[jayden]{cite Riordan}. 

\begin{restatable}{theorem}{modPFcount}
	\label{thm:modPFcount}
	The number of parking functions of length $gs - 1$ with gap $g$ between possible preferred spots is
	\[
		\# \mathrm{PF}_{gs - 1 \mid S} = s^{gs - 2}
	\]
	where $S$ is the set of the first $s$ natural numbers $j$ with $j \equiv 1 \pmod g$.
\end{restatable}

This is really the first case of a more general (though recursive) result for parking functions of length $gs - k$.

\begin{restatable}{theorem}{modPFcountGen}
	The number of parking functions of length $gs - k$ with gap $g$ between possible preferred spots is $\mathrm{PF}_{gs - k \mid S}$ and satisfies the relation
	\[
		s^{gs - k} = s \# \mathrm{PF}_{gs - k \mid S} + \sum_{n = 2}^{k} \frac{s}{n} \sum_{\lambda \vdash k, \lvert \lambda \rvert = n} \sum_{\mu \vdash s, \lvert \mu \rvert = n} \binom{gs - k}{g \mu - \lambda} \prod_{i = 1}^{n} \# \mathrm{PF}_{g \mu_{i} - \lambda_{i} \mid S}
	\]
\end{restatable} \todo[jayden]{credit Jasper} \todo[jayden]{partitions are ordered, change notation accordingly} \todo[jayden]{$S$ is not quite a subset of $[n]$ here}

In practice, the formula above is computationally intractable for large $g, s, k$, but can be useful to show special cases of small $k$ as below.

\begin{restatable}{example}{modPFcount2}
	The number of parking functions of length $gs - 2$ cars with gap $g$ between possible preferred spots is
	\[
		\#\mathrm{PF}_{gs - 2 \mid S} = s^{gs - 3} - \frac{1}{2} \sum_{i = 1}^{s - 1} \binom{gs - 2}{gs - 1} i^{gi - 2} (s - i)^{g(s - i) - 2}
	\]
	where $S$ is the set of the first $s$ natural numbers $j$ with $j \equiv 1 \pmod g$.
\end{restatable}

\section{Connections and conjectures}

\bibliography{references}
\bibliographystyle{alpha}

\end{document}
